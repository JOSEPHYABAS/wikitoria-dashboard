<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wikitoria Dashboard ‚Äî Gestion Comptable Compl√®te</title>
  
  <!-- Firebase SDK v9 (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  
  <!-- React & Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --secondary: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --dark: #1e293b;
      --light: #f1f5f9;
      --border: #e2e8f0;
      --text: #334155;
      --text-light: #64748b;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--text);
    }
    
    /* Login Page */
    .login-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .login-box {
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 400px;
    }
    
    .login-logo {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-logo h1 {
      color: var(--primary);
      font-size: 28px;
      margin-bottom: 8px;
    }
    
    .login-logo p {
      color: var(--text-light);
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
    }
    
    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.3s;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    .btn-login {
      width: 100%;
      padding: 14px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .btn-login:hover {
      background: var(--primary-dark);
    }
    
    .btn-login:disabled {
      background: var(--text-light);
      cursor: not-allowed;
    }
    
    .forgot-password {
      text-align: center;
      margin-top: 16px;
    }
    
    .forgot-password a {
      color: var(--primary);
      text-decoration: none;
      font-size: 14px;
    }
    
    .auth-message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }
    
    .auth-error {
      background: #fee;
      color: var(--danger);
      border: 1px solid var(--danger);
    }
    
    .auth-success {
      background: #efe;
      color: var(--secondary);
      border: 1px solid var(--secondary);
    }
    
    .hidden {
      display: none !important;
    }
    
    /* User Bar */
    .user-bar {
      background: white;
      padding: 16px 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: none;
      justify-content: space-between;
      align-items: center;
    }
    
    .user-bar.visible {
      display: flex;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }
    
    .user-details h3 {
      font-size: 14px;
      color: var(--text);
    }
    
    .user-role-badge {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      display: inline-block;
      margin-top: 2px;
    }
    
    .role-admin {
      background: #fee;
      color: var(--danger);
    }
    
    .role-manager {
      background: #fef3c7;
      color: #d97706;
    }
    
    .role-user {
      background: #dbeafe;
      color: var(--primary);
    }
    
    .btn-logout {
      padding: 8px 16px;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    .btn-logout:hover {
      background: #dc2626;
    }
    
    /* Dashboard Container */
    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }
    
    .dashboard-header {
      background: white;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .dashboard-title {
      font-size: 32px;
      color: var(--primary);
      margin-bottom: 8px;
    }
    
    .dashboard-subtitle {
      color: var(--text-light);
      font-size: 16px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      background: white;
      padding: 8px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      transition: all 0.3s;
    }
    
    .tab:hover {
      background: var(--light);
    }
    
    .tab.active {
      background: var(--primary);
      color: white;
    }
    
    /* Content Sections */
    .content-section {
      display: none;
    }
    
    .content-section.active {
      display: block;
    }
    
    /* Cards */
    .card {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 24px;
    }
    
    .card-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    
    .stat-card h3 {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 8px;
    }
    
    .stat-card .value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .stat-card .subtitle {
      font-size: 12px;
      opacity: 0.8;
    }
    
    /* Forms */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .form-input {
      width: 100%;
      padding: 10px;
      border: 2px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary);
    }
    
    select.form-input {
      cursor: pointer;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    
    .btn-secondary {
      background: var(--secondary);
      color: white;
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    /* Table */
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    
    th {
      background: var(--light);
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: var(--text);
      border-bottom: 2px solid var(--border);
    }
    
    td {
      padding: 12px;
      border-bottom: 1px solid var(--border);
    }
    
    tr:hover {
      background: #f8fafc;
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-pending {
      background: #fef3c7;
      color: #d97706;
    }
    
    .status-completed {
      background: #dcfce7;
      color: #16a34a;
    }
    
    .status-alert {
      background: #fee2e2;
      color: #dc2626;
    }
    
    .btn-small {
      padding: 4px 12px;
      font-size: 12px;
      margin-right: 4px;
    }
    
    .sync-status {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      padding: 12px 20px;
      border-radius: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      z-index: 1000;
    }
    
    .sync-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--secondary);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="login-page" class="login-container">
    <div class="login-box">
      <div class="login-logo">
        <h1>üè¢ Wikitoria Dashboard</h1>
        <p>Gestion Comptable Multi-Agences</p>
      </div>
      
      <div id="auth-error" class="auth-message auth-error"></div>
      <div id="auth-success" class="auth-message auth-success"></div>
      
      <form id="login-form">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" placeholder="votre@email.fr" required>
        </div>
        <div class="form-group">
          <label>Mot de passe</label>
          <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <button type="submit" id="login-btn" class="btn-login">Se connecter</button>
      </form>
      
      <div class="forgot-password">
        <a href="#" id="forgot-password">Mot de passe oubli√© ?</a>
      </div>
    </div>
  </div>
  
  <!-- User Bar -->
  <div id="user-bar" class="user-bar">
    <div class="user-info">
      <div class="user-avatar" id="user-avatar">U</div>
      <div class="user-details">
        <h3 id="user-name">Utilisateur</h3>
        <span class="user-role-badge" id="user-role">user</span>
      </div>
    </div>
    <button id="logout-btn" class="btn-logout">D√©connexion</button>
  </div>
  
  <!-- Dashboard -->
  <div id="root" class="hidden"></div>
  
  <!-- Sync Status -->
  <div id="sync-status" class="sync-status hidden">
    <div class="sync-dot"></div>
    <span>Synchronis√©</span>
  </div>
  
  <script>
    // ==================== FIREBASE CONFIG ====================
    // V√©rifier si Firebase est charg√©
    if (typeof firebase === 'undefined') {
      console.error('‚ùå Firebase non charg√©. V√©rifiez votre connexion Internet.');
      alert('‚ö†Ô∏è Firebase non charg√©.\n\nPour utiliser l\'application :\n1. V√©rifiez votre connexion Internet\n2. D√©sactivez les bloqueurs de publicit√©s\n3. Ou ouvrez le fichier via un serveur HTTP (pas en file://)');
    }
    
    // Configuration Firebase - Wikitoria Dashboard
    const firebaseConfig = {
      apiKey: "AIzaSyA8a89MzLBbRcQpLeqadzUJENwS_XwIWzY",
      authDomain: "wikitoria-dashboard.firebaseapp.com",
      databaseURL: "https://wikitoria-dashboard-default-rtdb.firebaseio.com",
      projectId: "wikitoria-dashboard",
      storageBucket: "wikitoria-dashboard.firebasestorage.app",
      messagingSenderId: "841128545223",
      appId: "1:841128545223:web:4086ebc079a478e86067e2",
      measurementId: "G-FVGVTE0P27"
    };
    
    // Initialize Firebase
    let auth, database;
    try {
      firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      database = firebase.database();
      console.log('‚úÖ Firebase initialis√© avec succ√®s');
    } catch (error) {
      console.error('‚ùå Erreur initialisation Firebase:', error);
    }
    
    let currentUser = null;
    let currentUserData = null;
    
    // ==================== AUTH MANAGEMENT ====================
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        
        // Load user data from Firebase
        const userRef = database.ref('users/' + user.uid);
        const snapshot = await userRef.once('value');
        currentUserData = snapshot.val() || { 
          email: user.email, 
          name: user.email.split('@')[0],
          role: 'user',
          createdAt: Date.now()
        };
        
        // Save user data if doesn't exist
        if (!snapshot.val()) {
          await userRef.set(currentUserData);
        }
        
        showDashboard();
        initApp();
      } else {
        currentUser = null;
        currentUserData = null;
        showLoginPage();
      }
    });
    
    // Login Form
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideMessages();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const loginBtn = document.getElementById('login-btn');
      
      loginBtn.disabled = true;
      loginBtn.innerHTML = 'Connexion...';
      
      try {
        await auth.signInWithEmailAndPassword(email, password);
      } catch (error) {
        let msg = "Erreur de connexion.";
        if (error.code === 'auth/user-not-found') msg = "Utilisateur non trouv√©.";
        else if (error.code === 'auth/wrong-password') msg = "Mot de passe incorrect.";
        else if (error.code === 'auth/invalid-email') msg = "Email invalide.";
        showError(msg);
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'Se connecter';
      }
    });
    
    // Logout
    document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
    
    // Forgot Password
    document.getElementById('forgot-password').addEventListener('click', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      if (!email) { 
        showError("Entrez votre email d'abord."); 
        return; 
      }
      try {
        await auth.sendPasswordResetEmail(email);
        showSuccess("Email de r√©initialisation envoy√© !");
      } catch (error) {
        showError("Erreur d'envoi.");
      }
    });
    
    function showLoginPage() {
      document.getElementById('login-page').classList.remove('hidden');
      document.getElementById('user-bar').classList.remove('visible');
      document.getElementById('root').classList.add('hidden');
      document.getElementById('sync-status').classList.add('hidden');
    }
    
    function showDashboard() {
      document.getElementById('login-page').classList.add('hidden');
      document.getElementById('user-bar').classList.add('visible');
      document.getElementById('root').classList.remove('hidden');
      document.getElementById('sync-status').classList.remove('hidden');
      
      const userName = document.getElementById('user-name');
      const userAvatar = document.getElementById('user-avatar');
      const userRole = document.getElementById('user-role');
      
      userName.textContent = currentUserData.name || currentUser.email;
      userAvatar.textContent = (currentUserData.name || currentUser.email).charAt(0).toUpperCase();
      userRole.textContent = currentUserData.role || 'user';
      userRole.className = `user-role-badge role-${currentUserData.role || 'user'}`;
    }
    
    function showError(msg) {
      const div = document.getElementById('auth-error');
      div.textContent = msg;
      div.style.display = 'block';
    }
    
    function showSuccess(msg) {
      const div = document.getElementById('auth-success');
      div.textContent = msg;
      div.style.display = 'block';
    }
    
    function hideMessages() {
      document.getElementById('auth-error').style.display = 'none';
      document.getElementById('auth-success').style.display = 'none';
    }
  </script>
  
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    
    // ==================== FIREBASE DATA SYNC ====================
    function useFirebaseData(path) {
      const [data, setData] = useState([]);
      const [loading, setLoading] = useState(true);
      
      useEffect(() => {
        if (!currentUser) return;
        
        const ref = database.ref(path);
        
        ref.on('value', (snapshot) => {
          const val = snapshot.val();
          const array = val ? Object.keys(val).map(key => ({ id: key, ...val[key] })) : [];
          setData(array);
          setLoading(false);
        });
        
        return () => ref.off('value');
      }, [path]);
      
      const addItem = async (item) => {
        const ref = database.ref(path);
        await ref.push({ ...item, createdAt: Date.now(), createdBy: currentUser.uid });
      };
      
      const updateItem = async (id, updates) => {
        await database.ref(`${path}/${id}`).update({ ...updates, updatedAt: Date.now() });
      };
      
      const deleteItem = async (id) => {
        await database.ref(`${path}/${id}`).remove();
      };
      
      return { data, loading, addItem, updateItem, deleteItem };
    }
    
    // ==================== MAIN APP ====================
    function App() {
      const [activeTab, setActiveTab] = useState('dashboard');
      
      const agences = useFirebaseData('agences');
      const declarations = useFirebaseData('declarations');
      const audits = useFirebaseData('audits');
      
      return (
        <div className="dashboard-container">
          <div className="dashboard-header">
            <h1 className="dashboard-title">Wikitoria Dashboard</h1>
            <p className="dashboard-subtitle">Gestion multi-agences synchronis√©e en temps r√©el</p>
          </div>
          
          <div className="tabs">
            <button className={`tab ${activeTab === 'dashboard' ? 'active' : ''}`} onClick={() => setActiveTab('dashboard')}>
              üìä Tableau de bord
            </button>
            <button className={`tab ${activeTab === 'agences' ? 'active' : ''}`} onClick={() => setActiveTab('agences')}>
              üè¢ Agences
            </button>
            <button className={`tab ${activeTab === 'tva' ? 'active' : ''}`} onClick={() => setActiveTab('tva')}>
              üí∞ TVA
            </button>
            <button className={`tab ${activeTab === 'cfe' ? 'active' : ''}`} onClick={() => setActiveTab('cfe')}>
              üèõÔ∏è CFE
            </button>
            <button className={`tab ${activeTab === 'tvs' ? 'active' : ''}`} onClick={() => setActiveTab('tvs')}>
              üöó TVS
            </button>
            <button className={`tab ${activeTab === 'audits' ? 'active' : ''}`} onClick={() => setActiveTab('audits')}>
              üîç Audits
            </button>
          </div>
          
          <div className={`content-section ${activeTab === 'dashboard' ? 'active' : ''}`}>
            <DashboardView agences={agences} declarations={declarations} audits={audits} />
          </div>
          
          <div className={`content-section ${activeTab === 'agences' ? 'active' : ''}`}>
            <AgencesView {...agences} />
          </div>
          
          <div className={`content-section ${activeTab === 'tva' ? 'active' : ''}`}>
            <TVAView {...declarations} agences={agences.data} />
          </div>
          
          <div className={`content-section ${activeTab === 'cfe' ? 'active' : ''}`}>
            <CFEView {...declarations} agences={agences.data} />
          </div>
          
          <div className={`content-section ${activeTab === 'tvs' ? 'active' : ''}`}>
            <TVSView {...declarations} agences={agences.data} />
          </div>
          
          <div className={`content-section ${activeTab === 'audits' ? 'active' : ''}`}>
            <AuditsView {...audits} agences={agences.data} />
          </div>
        </div>
      );
    }
    
    // ==================== DASHBOARD VIEW ====================
    function DashboardView({ agences, declarations, audits }) {
      const stats = useMemo(() => {
        const agencesCount = agences.data.length;
        const declarationsCount = declarations.data.length;
        const auditsCount = audits.data.length;
        const pendingAudits = audits.data.filter(a => a.status === 'pending').length;
        
        return { agencesCount, declarationsCount, auditsCount, pendingAudits };
      }, [agences.data, declarations.data, audits.data]);
      
      return (
        <>
          <div className="stats-grid">
            <div className="stat-card">
              <h3>Agences actives</h3>
              <div className="value">{stats.agencesCount}</div>
              <div className="subtitle">Multi-√©tablissements</div>
            </div>
            <div className="stat-card">
              <h3>D√©clarations</h3>
              <div className="value">{stats.declarationsCount}</div>
              <div className="subtitle">TVA, CFE, TVS</div>
            </div>
            <div className="stat-card">
              <h3>Audits en cours</h3>
              <div className="value">{stats.auditsCount}</div>
              <div className="subtitle">{stats.pendingAudits} en attente</div>
            </div>
            <div className="stat-card">
              <h3>Synchronisation</h3>
              <div className="value">‚úì</div>
              <div className="subtitle">Temps r√©el activ√©</div>
            </div>
          </div>
          
          <div className="card">
            <h2 className="card-title">Agences r√©centes</h2>
            <table>
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>SIRET</th>
                  <th>Ville</th>
                  <th>Statut</th>
                </tr>
              </thead>
              <tbody>
                {agences.data.slice(0, 5).map(agence => (
                  <tr key={agence.id}>
                    <td>{agence.nom}</td>
                    <td>{agence.siret}</td>
                    <td>{agence.ville}</td>
                    <td><span className="status-badge status-completed">Active</span></td>
                  </tr>
                ))}
                {agences.data.length === 0 && (
                  <tr><td colSpan="4" style={{textAlign: 'center', color: 'var(--text-light)'}}>
                    Aucune agence enregistr√©e
                  </td></tr>
                )}
              </tbody>
            </table>
          </div>
        </>
      );
    }
    
    // ==================== AGENCES VIEW ====================
    function AgencesView({ data, loading, addItem, updateItem, deleteItem }) {
      const [showForm, setShowForm] = useState(false);
      const [formData, setFormData] = useState({
        nom: '', siret: '', adresse: '', codePostal: '', ville: '', 
        telephone: '', email: '', regime: 'normal'
      });
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        await addItem(formData);
        setFormData({ nom: '', siret: '', adresse: '', codePostal: '', ville: '', telephone: '', email: '', regime: 'normal' });
        setShowForm(false);
      };
      
      return (
        <div className="card">
          <div className="card-title">
            <span>üè¢ Gestion des Agences</span>
            <button className="btn btn-primary" onClick={() => setShowForm(!showForm)}>
              {showForm ? 'Annuler' : '+ Nouvelle agence'}
            </button>
          </div>
          
          {showForm && (
            <form onSubmit={handleSubmit}>
              <div className="form-grid">
                <input className="form-input" placeholder="Nom de l'agence" value={formData.nom} 
                  onChange={e => setFormData({...formData, nom: e.target.value})} required />
                <input className="form-input" placeholder="SIRET" value={formData.siret}
                  onChange={e => setFormData({...formData, siret: e.target.value})} required />
                <input className="form-input" placeholder="Adresse" value={formData.adresse}
                  onChange={e => setFormData({...formData, adresse: e.target.value})} />
                <input className="form-input" placeholder="Code postal" value={formData.codePostal}
                  onChange={e => setFormData({...formData, codePostal: e.target.value})} />
                <input className="form-input" placeholder="Ville" value={formData.ville}
                  onChange={e => setFormData({...formData, ville: e.target.value})} />
                <input className="form-input" placeholder="T√©l√©phone" value={formData.telephone}
                  onChange={e => setFormData({...formData, telephone: e.target.value})} />
                <input className="form-input" type="email" placeholder="Email" value={formData.email}
                  onChange={e => setFormData({...formData, email: e.target.value})} />
                <select className="form-input" value={formData.regime}
                  onChange={e => setFormData({...formData, regime: e.target.value})}>
                  <option value="normal">R√©gime Normal</option>
                  <option value="simplifie">R√©gime Simplifi√©</option>
                  <option value="reel">R√©gime R√©el</option>
                </select>
              </div>
              <button type="submit" className="btn btn-primary">Enregistrer l'agence</button>
            </form>
          )}
          
          <div className="table-container">
            <table>
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>SIRET</th>
                  <th>Ville</th>
                  <th>R√©gime</th>
                  <th>Contact</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {data.map(agence => (
                  <tr key={agence.id}>
                    <td><strong>{agence.nom}</strong></td>
                    <td>{agence.siret}</td>
                    <td>{agence.ville}</td>
                    <td><span className="status-badge status-completed">{agence.regime}</span></td>
                    <td>{agence.email}</td>
                    <td>
                      <button className="btn btn-small btn-danger" onClick={() => deleteItem(agence.id)}>
                        Supprimer
                      </button>
                    </td>
                  </tr>
                ))}
                {data.length === 0 && (
                  <tr><td colSpan="6" style={{textAlign: 'center', color: 'var(--text-light)'}}>
                    Aucune agence. Cliquez sur "+ Nouvelle agence" pour commencer.
                  </td></tr>
                )}
              </tbody>
            </table>
          </div>
        </div>
      );
    }
    
    // ==================== TVA VIEW ====================
    function TVAView({ data, loading, addItem, agences }) {
      const [formData, setFormData] = useState({
        agenceId: '', periode: '', montantHT: '', montantTVA: '', type: 'CA3'
      });
      
      const tvaDeclarations = data.filter(d => d.type && d.type.startsWith('CA'));
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        await addItem({ ...formData, category: 'tva' });
        setFormData({ agenceId: '', periode: '', montantHT: '', montantTVA: '', type: 'CA3' });
      };
      
      return (
        <div className="card">
          <h2 className="card-title">üí∞ D√©clarations TVA</h2>
          
          <form onSubmit={handleSubmit}>
            <div className="form-grid">
              <select className="form-input" value={formData.agenceId}
                onChange={e => setFormData({...formData, agenceId: e.target.value})} required>
                <option value="">S√©lectionner une agence</option>
                {agences.map(a => <option key={a.id} value={a.id}>{a.nom}</option>)}
              </select>
              <input type="month" className="form-input" value={formData.periode}
                onChange={e => setFormData({...formData, periode: e.target.value})} required />
              <input type="number" className="form-input" placeholder="Montant HT" value={formData.montantHT}
                onChange={e => setFormData({...formData, montantHT: e.target.value})} required />
              <input type="number" className="form-input" placeholder="Montant TVA" value={formData.montantTVA}
                onChange={e => setFormData({...formData, montantTVA: e.target.value})} required />
              <select className="form-input" value={formData.type}
                onChange={e => setFormData({...formData, type: e.target.value})}>
                <option value="CA3">CA3 - Mensuel</option>
                <option value="CA12">CA12 - Trimestriel</option>
              </select>
            </div>
            <button type="submit" className="btn btn-primary">Enregistrer la d√©claration</button>
          </form>
          
          <table>
            <thead>
              <tr>
                <th>Agence</th>
                <th>P√©riode</th>
                <th>Type</th>
                <th>Montant HT</th>
                <th>TVA</th>
                <th>Total TTC</th>
              </tr>
            </thead>
            <tbody>
              {tvaDeclarations.map(decl => {
                const agence = agences.find(a => a.id === decl.agenceId);
                const ttc = parseFloat(decl.montantHT || 0) + parseFloat(decl.montantTVA || 0);
                return (
                  <tr key={decl.id}>
                    <td>{agence?.nom || 'N/A'}</td>
                    <td>{decl.periode}</td>
                    <td><span className="status-badge status-completed">{decl.type}</span></td>
                    <td>{parseFloat(decl.montantHT).toFixed(2)} ‚Ç¨</td>
                    <td>{parseFloat(decl.montantTVA).toFixed(2)} ‚Ç¨</td>
                    <td><strong>{ttc.toFixed(2)} ‚Ç¨</strong></td>
                  </tr>
                );
              })}
              {tvaDeclarations.length === 0 && (
                <tr><td colSpan="6" style={{textAlign: 'center', color: 'var(--text-light)'}}>
                  Aucune d√©claration TVA
                </td></tr>
              )}
            </tbody>
          </table>
        </div>
      );
    }
    
    // ==================== CFE VIEW ====================
    function CFEView({ data, loading, addItem, agences }) {
      const [formData, setFormData] = useState({
        agenceId: '', annee: new Date().getFullYear(), montant: '', dateEcheance: ''
      });
      
      const cfeDeclarations = data.filter(d => d.category === 'cfe');
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        await addItem({ ...formData, category: 'cfe', type: 'CFE' });
        setFormData({ agenceId: '', annee: new Date().getFullYear(), montant: '', dateEcheance: '' });
      };
      
      return (
        <div className="card">
          <h2 className="card-title">üèõÔ∏è Cotisation Fonci√®re des Entreprises (CFE)</h2>
          
          <form onSubmit={handleSubmit}>
            <div className="form-grid">
              <select className="form-input" value={formData.agenceId}
                onChange={e => setFormData({...formData, agenceId: e.target.value})} required>
                <option value="">S√©lectionner une agence</option>
                {agences.map(a => <option key={a.id} value={a.id}>{a.nom}</option>)}
              </select>
              <input type="number" className="form-input" placeholder="Ann√©e" value={formData.annee}
                onChange={e => setFormData({...formData, annee: e.target.value})} required />
              <input type="number" className="form-input" placeholder="Montant CFE" value={formData.montant}
                onChange={e => setFormData({...formData, montant: e.target.value})} required />
              <input type="date" className="form-input" value={formData.dateEcheance}
                onChange={e => setFormData({...formData, dateEcheance: e.target.value})} required />
            </div>
            <button type="submit" className="btn btn-primary">Enregistrer la CFE</button>
          </form>
          
          <table>
            <thead>
              <tr>
                <th>Agence</th>
                <th>Ann√©e</th>
                <th>Montant</th>
                <th>Date √©ch√©ance</th>
                <th>Statut</th>
              </tr>
            </thead>
            <tbody>
              {cfeDeclarations.map(decl => {
                const agence = agences.find(a => a.id === decl.agenceId);
                const isOverdue = new Date(decl.dateEcheance) < new Date();
                return (
                  <tr key={decl.id}>
                    <td>{agence?.nom || 'N/A'}</td>
                    <td>{decl.annee}</td>
                    <td><strong>{parseFloat(decl.montant).toFixed(2)} ‚Ç¨</strong></td>
                    <td>{decl.dateEcheance}</td>
                    <td>
                      <span className={`status-badge ${isOverdue ? 'status-alert' : 'status-completed'}`}>
                        {isOverdue ? 'En retard' : '√Ä jour'}
                      </span>
                    </td>
                  </tr>
                );
              })}
              {cfeDeclarations.length === 0 && (
                <tr><td colSpan="5" style={{textAlign: 'center', color: 'var(--text-light)'}}>
                  Aucune d√©claration CFE
                </td></tr>
              )}
            </tbody>
          </table>
        </div>
      );
    }
    
    // ==================== TVS VIEW ====================
    function TVSView({ data, loading, addItem, agences }) {
      const [formData, setFormData] = useState({
        agenceId: '', annee: new Date().getFullYear(), vehicules: '', montant: ''
      });
      
      const tvsDeclarations = data.filter(d => d.category === 'tvs');
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        await addItem({ ...formData, category: 'tvs', type: 'TVS' });
        setFormData({ agenceId: '', annee: new Date().getFullYear(), vehicules: '', montant: '' });
      };
      
      return (
        <div className="card">
          <h2 className="card-title">üöó Taxe sur les V√©hicules de Soci√©t√© (TVS)</h2>
          
          <form onSubmit={handleSubmit}>
            <div className="form-grid">
              <select className="form-input" value={formData.agenceId}
                onChange={e => setFormData({...formData, agenceId: e.target.value})} required>
                <option value="">S√©lectionner une agence</option>
                {agences.map(a => <option key={a.id} value={a.id}>{a.nom}</option>)}
              </select>
              <input type="number" className="form-input" placeholder="Ann√©e" value={formData.annee}
                onChange={e => setFormData({...formData, annee: e.target.value})} required />
              <input type="number" className="form-input" placeholder="Nombre de v√©hicules" value={formData.vehicules}
                onChange={e => setFormData({...formData, vehicules: e.target.value})} required />
              <input type="number" className="form-input" placeholder="Montant TVS" value={formData.montant}
                onChange={e => setFormData({...formData, montant: e.target.value})} required />
            </div>
            <button type="submit" className="btn btn-primary">Enregistrer la TVS</button>
          </form>
          
          <table>
            <thead>
              <tr>
                <th>Agence</th>
                <th>Ann√©e</th>
                <th>V√©hicules</th>
                <th>Montant</th>
              </tr>
            </thead>
            <tbody>
              {tvsDeclarations.map(decl => {
                const agence = agences.find(a => a.id === decl.agenceId);
                return (
                  <tr key={decl.id}>
                    <td>{agence?.nom || 'N/A'}</td>
                    <td>{decl.annee}</td>
                    <td>{decl.vehicules} v√©hicule(s)</td>
                    <td><strong>{parseFloat(decl.montant).toFixed(2)} ‚Ç¨</strong></td>
                  </tr>
                );
              })}
              {tvsDeclarations.length === 0 && (
                <tr><td colSpan="4" style={{textAlign: 'center', color: 'var(--text-light)'}}>
                  Aucune d√©claration TVS
                </td></tr>
              )}
            </tbody>
          </table>
        </div>
      );
    }
    
    // ==================== AUDITS VIEW ====================
    function AuditsView({ data, loading, addItem, updateItem, deleteItem, agences }) {
      const [formData, setFormData] = useState({
        agenceId: '', type: 'fiscal', dateDebut: '', dateFin: '', auditeur: '', notes: '', status: 'pending'
      });
      
      const handleSubmit = async (e) => {
        e.preventDefault();
        await addItem(formData);
        setFormData({ agenceId: '', type: 'fiscal', dateDebut: '', dateFin: '', auditeur: '', notes: '', status: 'pending' });
      };
      
      return (
        <div className="card">
          <h2 className="card-title">üîç Cycles d'Audit</h2>
          
          <form onSubmit={handleSubmit}>
            <div className="form-grid">
              <select className="form-input" value={formData.agenceId}
                onChange={e => setFormData({...formData, agenceId: e.target.value})} required>
                <option value="">S√©lectionner une agence</option>
                {agences.map(a => <option key={a.id} value={a.id}>{a.nom}</option>)}
              </select>
              <select className="form-input" value={formData.type}
                onChange={e => setFormData({...formData, type: e.target.value})}>
                <option value="fiscal">Audit Fiscal</option>
                <option value="social">Audit Social</option>
                <option value="comptable">Audit Comptable</option>
              </select>
              <input type="date" className="form-input" placeholder="Date d√©but" value={formData.dateDebut}
                onChange={e => setFormData({...formData, dateDebut: e.target.value})} required />
              <input type="date" className="form-input" placeholder="Date fin" value={formData.dateFin}
                onChange={e => setFormData({...formData, dateFin: e.target.value})} />
              <input className="form-input" placeholder="Auditeur" value={formData.auditeur}
                onChange={e => setFormData({...formData, auditeur: e.target.value})} required />
              <textarea className="form-input" placeholder="Notes" value={formData.notes}
                onChange={e => setFormData({...formData, notes: e.target.value})} />
            </div>
            <button type="submit" className="btn btn-primary">Cr√©er un audit</button>
          </form>
          
          <table>
            <thead>
              <tr>
                <th>Agence</th>
                <th>Type</th>
                <th>Auditeur</th>
                <th>P√©riode</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {data.map(audit => {
                const agence = agences.find(a => a.id === audit.agenceId);
                return (
                  <tr key={audit.id}>
                    <td>{agence?.nom || 'N/A'}</td>
                    <td><span className="status-badge status-completed">{audit.type}</span></td>
                    <td>{audit.auditeur}</td>
                    <td>{audit.dateDebut} ‚Üí {audit.dateFin || 'En cours'}</td>
                    <td>
                      <span className={`status-badge status-${audit.status}`}>
                        {audit.status === 'pending' ? 'En attente' : 
                         audit.status === 'completed' ? 'Termin√©' : 'En cours'}
                      </span>
                    </td>
                    <td>
                      {audit.status === 'pending' && (
                        <button className="btn btn-small btn-secondary" 
                          onClick={() => updateItem(audit.id, { status: 'completed' })}>
                          Terminer
                        </button>
                      )}
                      <button className="btn btn-small btn-danger" onClick={() => deleteItem(audit.id)}>
                        Supprimer
                      </button>
                    </td>
                  </tr>
                );
              })}
              {data.length === 0 && (
                <tr><td colSpan="6" style={{textAlign: 'center', color: 'var(--text-light)'}}>
                  Aucun audit enregistr√©
                </td></tr>
              )}
            </tbody>
          </table>
        </div>
      );
    }
    
    // ==================== INIT APP ====================
    function initApp() {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    }
  </script>
</body>
</html>